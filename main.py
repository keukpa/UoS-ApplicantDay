from machine import Pin, I2C
from ssd1306 import SSD1306_I2C
from dht import DHT11
from time import sleep
import framebuf

WIDTH  = 128
HEIGHT = 64

#This sets up the connection to the OLED Screen via the I2C protocol.
i2c = I2C(0, scl=Pin(9), sda=Pin(8), freq=200000)
#Setup our sensor object
dht11 = DHT11(Pin(15),None,dht11=True)
#Setup our OLED object
oled = SSD1306_I2C(WIDTH, HEIGHT, i2c)

#Images to be used in our code
weatherPartCloudy = bytearray(b"\x00\x00\x00\x00\x00\x0E\x00\x00\x00\x0E\x00\x00\x00\x0E\x00\x00\x0E\x04\x0C\x00\x0F\x00\x1C\x00\x07\x1E\x1C\x00\x00\x7F\xC0\x00\x00\xFB\xC0\x00\x00\xE0\xE0\x00\x01\xC0\x70\x00\x01\x80\x30\x00\x79\x87\xF3\xC0\x79\x9F\xFF\xC0\x01\xBC\x3E\x00\x01\xF0\x0F\x00\x0F\xE0\x07\xF0\x1F\xC0\x03\xF8\x3C\x00\x00\x1C\x30\x00\x00\x0E\x70\x00\x00\x06\x60\x00\x00\x06\x60\x00\x00\x06\x60\x00\x00\x06\x70\x00\x00\x06\x38\x00\x00\x0E\x3C\x60\x06\x3C\x1F\xF8\x0F\xF8\x07\xFE\x3F\xE0\x00\x1F\xF8\x00\x00\x07\xE0\x00\x00\x00\x00\x00")
weatherNightCloudy = bytearray(b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10\x00\x00\x00\x70\x00\x00\x00\xF0\x00\x00\x00\xF0\x00\x00\x01\xB0\x00\x00\x01\xB8\x00\x00\x01\x98\x00\x00\x01\x9C\x00\x00\x01\x8E\x00\x00\x0F\xF7\xF0\x00\x1F\xF8\xF0\x00\x7C\x3C\xE0\x00\xF0\x0F\xE0\x07\xE0\x07\xE0\x1F\xC0\x03\xF0\x1C\x00\x00\x38\x38\x00\x00\x1C\x30\x00\x00\x0C\x30\x00\x00\x0C\x30\x00\x00\x0C\x30\x00\x00\x0C\x38\x00\x00\x1C\x1C\x00\x00\x38\x0F\xF0\x0F\xF0\x07\xF8\x3F\xE0\x00\x1F\xF8\x00\x00\x0F\xF0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00")
sunny = bytearray(b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x80\x00\x00\x00\x80\x00\x00\x60\x03\x00\x00\x20\x02\x00\x00\x07\xE0\x00\x00\x0C\x38\x00\x00\x18\x08\x00\x00\x10\x0C\x00\x00\x10\x04\x00\x03\x90\x04\xE0\x00\x10\x0C\x00\x00\x18\x0C\x00\x00\x0C\x18\x00\x00\x07\x70\x00\x00\x03\xE0\x00\x00\x60\x03\x00\x00\x40\x01\x00\x00\x00\x80\x00\x00\x00\x80\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00")
fb = framebuf.FrameBuffer(sunny, 32, 32, framebuf.MONO_HLSB)
fb1 = framebuf.FrameBuffer(weatherPartCloudy, 32, 32, framebuf.MONO_HLSB)
fb2 = framebuf.FrameBuffer(weatherNightCloudy, 32, 32, framebuf.MONO_HLSB)

oled.fill(0)

oled.text("University of",0,0)
oled.text("Sunderland",0,8)
oled.text("Temp", 64, 26)
oled.text("Hum", 100, 26)
#-------------------------------------------------------------------

while(True):    
    T,H = dht11.read()
    if T is None:
        print("Unable to connect to sensor")
    else:
        print("Temperature :" + str(T) + "Â°C   "+ "Humidity:"+ str(H) +"%")

    oled.text(str(T)+"C", 64, 44)    # Display Temperature
    oled.text(str(H)+"%", 100, 44)   # Display Humidity

#-------- Edit the next line of code ------------------------------
    oled.blit(fb, 10, 24)
# End edit


# Display content on screen
    oled.show()

# Write file to Pi Pico
    weatherData = open("weather.txt","a")
    weatherData.write(str(T) + ", " + str(H) + "\r\n")
    weatherData.close()

    sleep(30)     # How often to log data in seconds. 
#-------------- End of Code ----------------------------------------